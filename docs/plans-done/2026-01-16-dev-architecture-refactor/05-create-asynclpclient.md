# Phase 5: Create AsyncLpClient

## Description

Create `AsyncLpClient` struct that wraps `AsyncClientTransport` and `LpClient`, providing typed async methods for filesystem and project operations. This is a thin wrapper that uses `LpClient` for request ID generation and message creation, then uses `AsyncClientTransport` for async communication.

## Tasks

1. Create `lp-app/apps/lp-cli/src/client/async_client.rs`:
   - Define `AsyncLpClient` struct with:
     - `transport: Arc<AsyncClientTransport>`
     - `client: LpClient`
   - Implement `new(transport: Arc<AsyncClientTransport>) -> Self`
   - Implement async methods wrapping `LpClient` methods:
     - `async fn fs_read(&mut self, path: &str) -> Result<Vec<u8>, Error>`
     - `async fn fs_write(&mut self, path: &str, data: Vec<u8>) -> Result<(), Error>`
     - `async fn project_load(&mut self, project_uid: &str) -> Result<ProjectHandle, Error>`
     - Add other methods as needed (fs_list_dir, fs_exists, etc.)
   - Each method should:
     - Call corresponding `LpClient` method to create request and get ID
     - Extract `ClientMessage` from `LpClient` (need helper method)
     - Call `transport.send_request(message).await?`
     - Downcast `ServerMessage` to appropriate response type
     - Extract result from response
     - Return typed result

2. Update `lp-app/apps/lp-cli/src/client/mod.rs`:
   - Add `pub mod async_client;`
   - Re-export `AsyncLpClient`

3. Add helper method to `LpClient` if needed:
   - Method to extract `ClientMessage` from pending request
   - Or: modify `LpClient` methods to return `ClientMessage` directly

4. Add tests:
   - Test with mock `AsyncClientTransport`
   - Test each async method (`fs_read`, `fs_write`, `project_load`)
   - Test error propagation from transport
   - Test request ID extraction from `LpClient`

## Success Criteria

- `AsyncLpClient` struct exists and compiles
- All async methods work correctly
- Request IDs are generated by `LpClient`
- Responses are correctly downcast and extracted
- Error propagation works correctly
- Tests pass
- Code compiles without errors

## Implementation Notes

- `LpClient` methods currently return `(Message, u64)` - need to extract `ClientMessage` from `Message::Client`
- Downcast `ServerMessage` to `ServerResponse` enum variants
- Handle `TransportError` and convert to `Error` type
- Consider adding timeout to `send_request()` calls (or handle in `AsyncClientTransport`)
- May need to add helper methods to `LpClient` to extract messages without sending
- Or: modify `LpClient` to have methods that return `ClientMessage` directly (but this changes lp-client API)
